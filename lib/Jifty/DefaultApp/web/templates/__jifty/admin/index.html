<%init>

    # Set up application-specific parts
    my $ApplicationClass = Jifty->config->framework('ApplicationClass');
    # This creates a sub "models" which when called, finds packages under
    # $ApplicationClass::Model, requires them, and returns a list of their
    # names.
       

        my @models;   

    Module::Pluggable->import(
        require     => 1,
        search_path => [  $ApplicationClass . "::Model" ],
        sub_name    => 'jifty_app_models',
    );

        for my $model ( __PACKAGE__->jifty_app_models ) {

            # We don't want to get the Collections, or models that have a
            # 'since' that is after the current application version.

       # TODO XXX FIXME:
       #   This *will* try to generate SQL for abstract base classes you might
       #   stick in $AC::Model::.
                next if not UNIVERSAL::isa( $model, 'Jifty::Record' );
        push @models, $model


        }


</%init>
<&|/_elements/wrapper, title => 'Jifty Administrative Console' &>

<h1>Database Administration</h1>

<p>This console lets you manage the records in your Jifty database. Below, you should see a list of all your database tables. Feel free to go through and add, delete or modify records.</p>

<p>To disable this administrative console, add "framework: AdminMode: 0" to your application's configuration file.</p>
    


% foreach my $model (@models) {
% next unless ($model =~ /^(?:.*)::(.*?)$/);
% my $type = $1;
<li><% Jifty->web->tangent( url => '/__jifty/admin/'.$type, label => $type)%>
%}

<h2>All done?</h2>
<% Jifty->web->return(label => 'Back to wherever you came from') %>


</&>
