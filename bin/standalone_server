#!/usr/bin/perl
use warnings;
use strict;
use File::Basename;

BEGIN {
  my $dir = dirname(__FILE__);
  push @INC, "$dir/../lib";
  push @INC, "$dir/../../Jifty/lib";
}

# When a browser closes the connection early, the server will get a SIGPIPE.
local $SIG{PIPE} = sub { warn "Trapped a SIGPIPE."};

use Jifty::Everything;
use Jifty::Server;

my $app = Jifty->new(config_file => $ENV{'Jifty_CONFIG'} ||   
                                   dirname(__FILE__).'/../etc/config.yml');

my $server = Jifty::Server->new(application => $app);
$server->recording_on if grep /^-r$/, @ARGV; # TODO XXX FIXME real option handling
$server->run();

1;
